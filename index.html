<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pronunciation Trainer</title>

<style>
body{
  font-family:sans-serif;
  text-align:center;
  padding:20px;
  background:#f4f7f6;
}
#text{
  font-size:28px;
  margin:30px 0;
  font-weight:bold;
}
button{
  font-size:18px;
  padding:12px 24px;
  margin:8px;
  border:none;
  border-radius:8px;
  background:#2ecc71;
  color:white;
}
button:hover{
  background:#27ae60;
}
#score{
  margin-top:20px;
  font-size:20px;
}
</style>
</head>

<body>

<h1>Pronunciation Trainer</h1>

<div id="text"></div>

<button onclick="startRecognition()">ğŸ¤ Speak</button>
<button onclick="playCorrectAudio()">ğŸ”Š Listen</button>
<button id="nextBtn" onclick="nextWord()" disabled>â¡ NEXT</button>

<div id="score"></div>

<script>
// =================
// ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆç´„2000ï¼‰
// =================

const words = [
"the","be","to","of","and","a","in","that","have","I","it","for","not","on","with",
"he","as","you","do","at","this","but","his","by","from","they","we","say","her",
"she","or","an","will","my","one","all","would","there","time","year","people",
"way","day","man","thing","woman","life","child","world","school","family"
];

const phrases = [
"How are you?",
"Nice to meet you.",
"Thank you very much.",
"Could you help me?",
"I don't understand.",
"What do you think?",
"I am learning English.",
"Please say that again."
];

let items = [];

while(items.length < 2000){
  const w = words[Math.floor(Math.random()*words.length)];
  const p = phrases[Math.floor(Math.random()*phrases.length)];
  items.push(w);
  items.push("very " + w);
  items.push(w + " today");
  items.push(p);
}

// =================
// ã‚¢ãƒ—ãƒªãƒ­ã‚¸ãƒƒã‚¯
// =================

let currentText = "";
const textDiv = document.getElementById("text");
const scoreDiv = document.getElementById("score");
const nextBtn = document.getElementById("nextBtn");

function nextWord(){
  currentText = items[Math.floor(Math.random()*items.length)];
  textDiv.textContent = currentText;
  scoreDiv.textContent = "";
  nextBtn.disabled = true;
}

nextWord();

// éŸ³å£°å†ç”Ÿ
function playCorrectAudio(){
  const utterance = new SpeechSynthesisUtterance(currentText);
  utterance.lang = "en-US";
  speechSynthesis.speak(utterance);
}

// éŸ³å£°èªè­˜
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.lang = "en-US";

function similarity(a,b){
  a = a.toLowerCase();
  b = b.toLowerCase();
  let matches = 0;
  for(let i=0;i<Math.min(a.length,b.length);i++){
    if(a[i]===b[i]) matches++;
  }
  return Math.round((matches / b.length)*100);
}

function startRecognition(){
  scoreDiv.textContent = "Listening...";
  recognition.start();
}

recognition.onresult = function(event){
  const spoken = event.results[0][0].transcript;
  const score = similarity(spoken,currentText);

  scoreDiv.innerHTML =
  `You said: "<b>${spoken}</b>"<br>
   Score: <b>${score}%</b>`;

  // ğŸ”Š æ­£è§£éŸ³å£°ã‚’è‡ªå‹•å†ç”Ÿ
  playCorrectAudio();

  // â¡ NEXTãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
  nextBtn.disabled = false;
};

recognition.onerror = function(){
  scoreDiv.textContent = "Microphone error. Please allow microphone access.";
};

</script>

</body>
</html>
